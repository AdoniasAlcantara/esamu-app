Index: app/src/main/java/org/myopenproject/esamu/presentation/emergency/CameraActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package org.myopenproject.esamu.presentation.emergency;\n\nimport android.Manifest;\nimport android.content.Intent;\nimport android.content.pm.ActivityInfo;\nimport android.content.pm.PackageManager;\nimport android.graphics.Bitmap;\nimport android.hardware.Camera;\nimport android.os.Bundle;\nimport android.support.annotation.NonNull;\nimport android.support.v7.app.AppCompatActivity;\nimport android.view.ViewGroup;\nimport android.widget.ImageButton;\n\nimport org.myopenproject.esamu.R;\nimport org.myopenproject.esamu.util.Device;\nimport org.myopenproject.esamu.util.Dialog;\nimport org.myopenproject.esamu.util.Image;\nimport org.myopenproject.esamu.util.Permission;\n\nimport java.io.ByteArrayOutputStream;\n\n@SuppressWarnings(\"deprecation\")\npublic class CameraActivity extends AppCompatActivity {\n    public static final String IMAGE_EXTRA = \"pictureTaken\";\n    private static final int CAMERA_PERMISSION_REQUEST = 999;\n    private Camera camera;\n\n    @Override\n    protected void onCreate(Bundle bundle) {\n        super.onCreate(bundle);\n        setContentView(R.layout.activity_camera);\n\n        if (Permission.validate(this, CAMERA_PERMISSION_REQUEST, Manifest.permission.CAMERA))\n            initCamera();\n\n        // Set button event\n        ImageButton buttonTakePicture = findViewById(R.id.cameraButtonTakePicture);\n        buttonTakePicture.setOnClickListener(v -> {\n            buttonTakePicture.setEnabled(false);\n            camera.takePicture(null, null, (data, cam) -> {\n                setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LOCKED);\n                onPictureTaken(data);\n            });\n        });\n\n        boolean isPictureTaken = getIntent()\n                .getBooleanExtra(EmergencyActivity.IS_PICTURE_TAKEN_PARAM, false);\n\n        if (!isPictureTaken)\n            Dialog.alert(this, R.string.camera_dialog_title, R.string.camera_dialog_msg);\n    }\n\n    @Override\n    protected void onDestroy() {\n        if (camera != null)\n            camera.release();\n\n        super.onDestroy();\n    }\n\n    @Override\n    public void onRequestPermissionsResult(\n            int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n        if (requestCode == CAMERA_PERMISSION_REQUEST\n                && grantResults.length > 0\n                && grantResults[0] == PackageManager.PERMISSION_GRANTED) {\n            initCamera();\n        } else {\n            Dialog.alert(this,\n                    R.string.error_permission_title,\n                    R.string.error_permission_camera,\n                    (dialog, which) -> finish());\n        }\n    }\n\n    private void initCamera() {\n        camera = Device.getCamera(this);\n        CameraPreview preview = new CameraPreview(this, camera);\n        ViewGroup layoutPreview = findViewById(R.id.cameraLayoutPreview);\n        layoutPreview.addView(preview);\n    }\n\n    private void onPictureTaken(byte[] data) {\n        int rotation = Device.getRotation(this);\n        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_FULL_USER);\n\n        // Fix image rotation on Samsung and Sony devices\n        Bitmap bitmap = Image.fixRotation(data, rotation);\n\n        // Convert bitmap into JPEG format\n        ByteArrayOutputStream bStream = new ByteArrayOutputStream();\n        bitmap.compress(Bitmap.CompressFormat.JPEG, 100, bStream);\n        data = bStream.toByteArray();\n\n        // Return the resulting image\n        Intent result = new Intent();\n        result.putExtra(IMAGE_EXTRA, data);\n        setResult(RESULT_OK, result);\n        finish();\n    }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/org/myopenproject/esamu/presentation/emergency/CameraActivity.java	(revision ddbaa36414e099d0647abfd2fdfdd75cf38c5273)
+++ app/src/main/java/org/myopenproject/esamu/presentation/emergency/CameraActivity.java	(date 1550784055000)
@@ -64,7 +64,8 @@
             int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
         if (requestCode == CAMERA_PERMISSION_REQUEST
                 && grantResults.length > 0
-                && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
+                && grantResults[0] == PackageManager.PERMISSION_GRANTED)
+        {
             initCamera();
         } else {
             Dialog.alert(this,
